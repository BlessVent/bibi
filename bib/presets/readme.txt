



□ 指定マニュアル 2013/06/23 版（文責：松島 智）




かんたんですが、プリセットについて解説します。

今後マニュアルにまとめる計画ですので、読みづらさはしばしご容赦ください。


プリセットファイルは、URL のクエリで使い分けることができます。

EPUB をドラッグアンドドロップしてもらうときも予め設定を読ませておけますし、
（http://anatano.website/bib/i/?preset=PRESET.js）
サーバに置いた EPUB やフォルダを読むときも、プリセットをペアにした URL を発行できます。
（http://anatano.website/bib/i/?book=EPUB.epub&preset=PRESET.js）
（http://anatano.website/bib/i/?book=EPUB&preset=PRESET.js）

指定がないときは、bib/preset/default.js が使用されます。
まずは default.js を編集して使うのがよいかもしれません。


以下、具体的な指定について説明しますが、
多くは、対象とする EPUB によって一長一短があります。
（だからこそプリセットとして編集可能にしたわけなのですが）

読者自身が読みながら変更できる項目もありますが、
もしご自身で作成した EPUB を読者に見せたい場合や、
ご自身で見た目をカスタマイズした BiB/i を読者に使ってもらいたい場合など、
EPUB に合わせたスタイルやあなたらしいスタイルを予めプリセットで指定しておくと、
きっとステキだと思いますよ☆

（要は投げているのです。）
（いえ、ウソです、ちゃんとデフォルトも考慮してます。）


以下、カギ括弧付きの「長さ」とは、見開きの進行方向サイズのことです。
横並びなら左右幅、縦並びなら上下高にあたります。
同様に、カギ括弧付きの「広さ」は、横並びなら上下高、縦並びなら左右幅です。




■ name: "なまえ" …… プリセットの任意名称

いまのところどこにも使用されていませんが、
コントロールパネルからプリセットを切り替える機能をつけるかもしれず、
その暁には設定パネル内でラベルとして使用される予定であります。


■ description: "説明" …… プリセットの内容説明

これも、切り替え機能で使うかもしれない予定です。


■ "book-display-mode" …… 表示モード（全部・見開き・ファイル単体）の初期値

"all" を指定すると、書籍の表示データすべてを並べます。
"spread" では見開き単位。固定レイアウトなどでは２つのアイテムで１つの見開きを構成するものが多いです。
"item" は、ファイル単位。見開きの左右ページとしてペアが存在していても、そのペアは表示しません。

読者は随時変更できるので、あくまで最初にどのモードで表示するか、ということです。
※ "item" モードは廃止の可能性が高いです。コントロールバーからも切り替えボタンを取り除きました。


■ "page-progression-direction" …… ページめくり方向の初期値

EPUB 側で page-progression-direction が未指定もしくは "default" だった場合に、
ページめくり方向として選択されます。
BiB/i はスクロールベースのリーダなので「ページってなんだよ」と思われるかもしれませんが、
これは固定レイアウトで２ページが見開きになるときの配置方向にも関わるのです。
また、固定レイアウトや縦書きのときはスクロール方向にも反映されます。

オプションにせず "ltr" 固定にしようかとも思いました。
というのも、まあ、世界的に考えてあたりまえといえばあたりまえですが、
「リーダ側のデフォルトは "ltr" である」という想定の EPUB が大半なので。

でも「リーダ側のデフォルトは "ltr" であるべき」という仕様はありませんでしたので、
単純に暗黙の了解にしてしまうのもなんだかなと思い、残してあります。

とはいえ、"ltr" としておくのがオススメです。

たとえば、日本語縦書きやアラビア語に特化した最適化をしたいときなど、
非常に限られた場合に、"rtl" にしておくと便利な場合が、あるかもしれません。
ただ、ふつうは実際問題として困ったことになる場合がほとんどかと思います。



■ "spread-layout-direction" …… 見開き配置方向の初期値

このプリセットでは "vertical" / "horizontal" / "ttb" / "ltr" / "rtl" / "auto" が指定できるのですが、
最終的には "ttb" / "ltr" / "rtl" の３つに落とし込まれます。

デフォルトとして推奨いたしますところの "auto" では、
まず、EPUB 内で page-progression-direction に指定がある場合、
それに従って "ltr" / "rtl" いずれかとなります。
次に、EPUB 内に page-progression-direction の指定がなくて EPUB 全体が固定レイアウトの場合、
このプリセットの "page-progression-direction" の決定に従って "ltr" / "rtl" いずれかとなります。
最後に、EPUB 内に page-progression-direction の指定がなくて EPUB 全体がリフローの場合、
ウェブページっぽく上から下に並べる "ttb" となります。

"vertical" を指定するともれなく "ttb" となり、
"horizontal" ではこのプリセットの "page-progression-direction" の決定に従って "ltr" / "rtl" となります。

ページめくり方向が水平の EPUB を敢えてタテ配置で表示すると、
便利だったり読みやすかったりする場合があります。（マンガは星海社「最前線」みたいに表示されます）

いずれにせよこれはデフォルト値で、
見開き配置方向＝スクロール方向は、読者が随時変更できます。

"ltr" と "rtl" を直接指定すると、
EPUB 制作者の意図と異なる配置を強制してしまう場合があります。
一般の EPUB リーダではあまりみられない配置をおもしろがれる、かも、しれません。
ただし読者がタテヨコ変更ボタンで配置を変えると "page-progression-direction" の値で上書きされますので、
テスト目的以外ではご遠慮いただくのが無難です。


■ "page-orientation" …… 仮想「ページ」の比率

※ 初回リリース時、"spread-orientation" という名称でしたが、ふさわしくないので変更しました。

まだこなれた設定ではないので、
もうすこししてからちゃんと解説します。

メモ程度に書いておきますと、
ビビが内部的に把握している仮想的な「ページ」の寸法比率をどのようにとるかの設定で、
横書き文書を横配置したときの段組幅や、
前後移動アローを押したときの移動距離に関わります。

"portrait" / "landscape" / "window" / "auto" が指定できますが、この仕様はまだ不確定です。
いまは "auto" にしておくのがオススメですが、
たとえば電子雑誌の「トルタル」など、
横書き文書の横配置のときに "portrait" がキレイにはまる場合があります。

のちに、もっとわかりやすくして、
スイッチで読者が変更できるようにするか、
ウィンドウサイズに応じるようにするか、
などを考えます。


■ "book-background" …… 見開きの下の背景

CSS の background そのままでどうぞ。つまり背景画像とかも使えます。


■ "spread-separation" …… 見開きと見開きの間隔

見開き同士の間隔です。
"spread-layout-direction" が "ttb" なら上下、"ltr" / "rtl" なら左右ですね。

最初と最後の見開きとウィンドウ端の距離は、この半分の値になります。
その計算のため、ここに奇数値を指定されていても1足して強制的に偶数にしています。
（小数点以下を含む指定も四捨五入してしまいます）

後述の "center-end-spread" が有効だと、
最初と最後の見開きはウィンドウの真ん中に来るようにウィンドウ端との距離が調節されます。

これも含め、"_narrow-device" が付いた指定は、
iOS と Android の場合に優先されます。
現状はメディアクエリほかでスクリーンサイズを判別したりはしていません。


■ "spread-margin-start" / "spread-margin-before" …… 見開きとウィンドウの間隔

見開きとウィンドウの、見開き配置方向と垂直方向にあたる側の間隔です。

"spread-margin-start" は、
"spread-layout-direction" が "ttb" で "page-progression-direction" が "ltr" なら左、"rtl" なら右。
"spread-layout-direction" が "ltr" / "rtl" なら 上。

"spread-margin-end" は "spread-margin-start" の反対側です。

※ いまのところ、 "spread-layout-direction" が "ttb" のとき、
※ "page-progression-direction" に応じた間隔を取っていないかもしれません。
※ 確認して、おかしければ直します。


■ "spread-border-radius" …… 見開きのカドを丸めるならその半径

CSS 3 でできるようになったことのうち、
ウェブ制作者がもっともわかりやすく小躍りした、カド丸指定。
ついついつけちゃうカド丸。お好みに応じてどうぞ。
CSS の border-radius そのままです。


■ "spread-box-shadow" …… 見開きに影を付けるなら CSS を

カド丸に並びウェブ制作者を小躍りさせた、影指定。
見開きのドロップシャドウです。CSS そのままの指定でどうぞ。
影を付けるとすこしスクロールがもたつくかもしれませんので、
ないほうがいいかもしれないですよ。不要なら "none" としてください。
CSS の box-shadow そのままです。



■ "item-padding-left" / "item-padding-right" / "item-padding-top" / "item-padding-bottom" …… 各アイテム内の余白

見開き内、コンテンツまでの余白です。

数値の単位はすべて px（ピクセル）。

ホントは全部 0 でいいんじゃないかと思うんですけど、
iBooks はじめ、制御不能な余白をつけるリーディングシステムが幅を利かせていることもあり（あれキライ）、
内部の CSS に余白を持たせていない EPUB がかなり多いですよね。そのためにあります。

中身が固定レイアウトのときは無視され、余白はとられません。

また、余白にコンテンツ内部の背景が適用されない」……ということにならないよう、
すこしだけ工夫してみました。万全ではないのですが。
もし余白に背景が出ないような本に対しては、指定を諦めてください（あまりないと思うけれど）。

余談ですが、BiB/i はコンテンツ内の html 要素と body 要素の margin / padding を 0 にします。
異論はあるとおもいます。ぼくもモヤモヤしてます。
でも、そうしたほうが良好な結果が得られる場合が多いのです。

※ JavaScript 的に !isNaN な値がセットされれば、式などを使っても大丈夫です。ただし四捨五入されます。
※ 余談ですが、衝突回避を意識してもらえればこのファイル内で変数や関数なども使ってかまいません。
※ なんなら外部ライブラリもつかえちゃいますね。（……誰が何のために使うのか）


■ "item-column-rule" …… 段組されたときの境界線表示

CSS の column-rule そのままです。不要なら "" 空値にしておきます。

ちなみにビビではなく CSS の領分の話ですが、この線の太さは、column-gap に影響しません。


■ "spread-min-length" …… 見開きの最短「長さ」をどう確保するか
■ "spread-min-length_single-image" …… アイテム内のコンテンツが画像だけの場合の "spread-min-length"

自動制御を行うことにしてプリセットからは削除しました。


■ "center-end-spreads" …… 最初と最後の見開きが画面中央に来るように余白を調整するかどうか

縦書きの本やマンガの表紙など、幅の狭いアイテム１つで構成される見開きは、
設定によっては、ウィンドウの「長さ」より「短く」なります。

そういう見開きが最初もしくは最後にあり、この設定が true になっていると、
"book-padding-before" / "book-padding-after" の値にかかわらず、
画面の真ん中に来るようにウィンドウ端との距離が調整されます。
すこし端っこらしくなる、というわけです。




