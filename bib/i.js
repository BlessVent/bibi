/*!
 *
 *  # Pipi: BiB/i Putter
 *
 *  - "Putting EPUBs in a Web Page with BiB/i."
 *  - (c) Satoru MATSUSHIMA - http://bibi.epub.link/
 *  - Licensed under the MIT license. - http://www.opensource.org/licenses/mit-license.php
 *
 *  - Thu May 28 12:13:00 2015 +0900
 */
!function(){if(!window["bibi:pipi"]){var a=window["bibi:pipi"]={Version:"0.999.0",Build:20150528,Status:"",Bibis:[],Anchors:[],Holders:[],Frames:[],Loaded:0};a.BibiPath=document.querySelector('script[src$="bib/i.js"]').src.replace(/\.js$/,""),a.embed=function(){a.Status="Started";for(var b=document.body.querySelectorAll("a[data-bibi]"),c=b.length,d=0;c>d;d++)if(b[d].getAttribute("href")&&!b[d].Bibi){var e={Index:d,Number:d+1},f=e.Anchor=b[d];/ bibi-anchor /.test(" "+f.className+" ")||(f.className="bibi-anchor"+(f.className?" "+f.className:""));var g=Href=f.getAttribute("href"),h=f.getAttribute("data-bibi-class"),i=f.getAttribute("data-bibi-id"),j=f.getAttribute("data-bibi-style"),k=f.getAttribute("data-bibi-poster"),l=f.getAttribute("data-bibi-autostart"),m=f.getAttribute("data-bibi-to"),n=f.getAttribute("data-bibi-view"),o=f.getAttribute("data-bibi-arrows");f.addEventListener("bibi:load",function(a){console.log("BiB/i: Loaded. - #"+a.detail.Number+": "+a.detail.Anchor.href)},!1),f.addEventListener("bibi:openInNewWindow",function(a){console.log("BiB/i: Opened in New Window. - #"+a.detail.Number+": "+a.detail.Anchor.href)},!1),f.addEventListener("bibi:requestFullscreen",function(a){console.log("BiB/i: Entered Fullscreen. - #"+a.detail.Number+": "+a.detail.Anchor.href)},!1),f.addEventListener("bibi:exitFullscreen",function(a){console.log("BiB/i: Exited Fullscreen. - #"+a.detail.Number+": "+a.detail.Anchor.href)},!1),a.Anchors.push(f);var p=e.Holder=a.create("span",{className:"bibi-holder",title:(f.innerText?f.innerText+" ":"")+"(powered by BiB/i)"});h&&(p.className+=" "+h),i&&(p.id=i),j&&p.setAttribute("style",j);var q=[];if("string"==typeof l&&/^(undefined|autostart|yes|true)?$/.test(l)&&q.push("autostart"),k){var r=a.create("link",{href:k});k=r.href,delete r,q.push("poster:"+a.encode(k))}location.origin!=f.origin&&q.push("parent-origin:"+a.encode(location.origin)),m&&/^\d[\d\-\.]+$/.test(m)&&q.push("to:"+m),n&&/^fixed$/.test(n)&&q.push("view:"+n),o&&/^hidden$/.test(o)&&q.push("arrows:"+o),q.length&&(g+=(/#/.test(g)?",":"#")+"pipi("+q.join(",")+")"),a.Holders.push(p);var s=e.Frame=p.appendChild(a.create("iframe",{className:"bibi-frame",frameborder:"0",scrolling:"auto",allowfullscreen:"true",webkitallowfullscreen:"true",mozallowfullscreen:"true",src:g}));s.addEventListener("load",function(){a.Loaded++,this.Bibi.Anchor.dispatchEvent(new CustomEvent("bibi:load",{detail:this.Bibi})),"Timeouted"!=a.Status&&a.Loaded==a.Bibis.length&&(a.Status="Loaded",document.dispatchEvent(new CustomEvent("bibi:load",{detail:a})))},!1),a.Frames.push(s);var t=e.SwitchNewWindow=a.create("a",{className:"bibi-icon bibi-switch-newwindow",title:"Open in New Window",target:"_blank",href:Href});if(t.addEventListener("click",function(a){return a.stopPropagation(),f.dispatchEvent(new CustomEvent("bibi:openInNewWindow",{detail:this.Bibi})),!0}),t.style.display="none",f.addEventListener("bibi:load",function(){this.Bibi.SwitchNewWindow.style.display=""}),p.appendChild(t),a.FullscreenEnabled){p.className+=" bibi-fullscreen-enabled";var u=e.SwitchFullscreen=a.create("span",{className:"bibi-icon bibi-switch-fullscreen",title:"Enter Fullscreen",Holder:p});u.addEventListener("click",function(b){return b.preventDefault(),b.stopPropagation(),a.getFullscreenElement(document)?(a.exitFullscreen(document),this.title="Enter Fullscreen",f.dispatchEvent(new CustomEvent("bibi:exitFullscreen",{detail:this.Bibi}))):(a.requestFullscreen(this.Holder),this.title="Exit Fullscreen",f.dispatchEvent(new CustomEvent("bibi:requestFullscreen",{detail:this.Bibi}))),!0}),u.style.display="none",f.addEventListener("bibi:load",function(){this.Bibi.SwitchFullscreen.style.display=""}),p.appendChild(u)}else{p.className+=" bibi-fullscreen-not-enabled";var u={}}a.Bibis.push(e),s.Bibi=p.Bibi=f.Bibi=t.Bibi=u.Bibi=e}for(var d=0,c=a.Bibis.length;c>d;d++)if(!a.Bibis[d].Embedded){var e=a.Bibis[d];e.Anchor.style.display="none",e.Anchor.parentNode.insertBefore(e.Holder,e.Anchor),e.Anchor.dispatchEvent(new CustomEvent("bibi:ready",{detail:e})),e.Anchor.dispatchEvent(new CustomEvent("bibi:holderadded",{detail:{holder:e.Holder},bubbles:!0,cancelable:!0}))}return setTimeout(function(){"Loaded"!=a.Status&&(a.Status="Timeouted",document.dispatchEvent(new CustomEvent("bibi:timeout",{detail:a})))},12e3),a.Status="Readied",document.dispatchEvent(new CustomEvent("bibi:ready",{detail:a})),a.Bibis},a.encode=function(a){return encodeURIComponent(a).replace("(","_BibiKakkoOpen_").replace(")","_BibiKakkoClose_")},a.create=function(a,b){var c=document.createElement(a);for(var d in b)c[d]=b[d];return c},(document.body.requestFullscreen||document.body.requestFullScreen||document.body.webkitRequestFullscreen||document.body.webkitRequestFullScreen||document.body.mozRequestFullscreen||document.body.mozRequestFullScreen||document.body.msRequestFullscreen)&&(a.FullscreenEnabled=!0,a.requestFullscreen=function(a){var b=function(b){return function(c){return c||(c=a),c[b]()}};return a.requestFullscreen?b("requestFullscreen"):a.requestFullScreen?b("requestFullScreen"):a.webkitRequestFullscreen?b("webkitRequestFullscreen"):a.webkitRequestFullScreen?b("webkitRequestFullScreen"):a.mozRequestFullscreen?b("mozRequestFullscreen"):a.mozRequestFullScreen?b("mozRequestFullScreen"):a.msRequestFullscreen?b("msRequestFullscreen"):function(){return!1}}(document.documentElement),a.exitFullscreen=function(a){var b=function(b){return function(c){return c||(c=a),c[b]()}};return a.exitFullscreen?b("exitFullscreen"):a.cencelFullScreen?b("cencelFullScreen"):a.webkitExitFullscreen?b("webkitExitFullscreen"):a.webkitCancelFullScreen?b("webkitCancelFullScreen"):a.mozExitFullscreen?b("mozExitFullscreen"):a.mozRequestFullScreen?b("mozRequestFullScreen"):a.msExitFullscreen?b("msExitFullscreen"):function(){return!1}}(document),a.getFullscreenElement=function(a){var b=function(b){return function(c){return c||(c=a),c[b]}};return"undefined"!=typeof a.fullscreenElement?b("fullscreenElement"):"undefined"!=typeof a.fullScreenElement?b("fullScreenElement"):"undefined"!=typeof a.webkitFullscreenElement?b("webkitFullscreenElement"):"undefined"!=typeof a.webkitFullScreenElement?b("webkitFullScreenElement"):"undefined"!=typeof a.mozFullscreenElement?b("mozFullscreenElement"):"undefined"!=typeof a.mozFullScreenElement?b("mozFullScreenElement"):"undefined"!=typeof a.msFullscreenElement?b("msFullscreenElement"):function(){return null}}(document)),"undefined"==typeof window.CustomEvent&&(window.CustomEvent=function(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c},window.CustomEvent.prototype=window.Event.prototype),document.getElementsByTagName("head")[0].appendChild(a.create("link",{rel:"stylesheet",id:"bibi-css",href:a.BibiPath+".css"})),document.addEventListener("bibi:ready",function(a){console.log("BiB/i: Readied. - "+a.detail.Bibis.length+" Bibi(s).")},!1),document.addEventListener("bibi:load",function(a){console.log("BiB/i: Loaded. - "+a.detail.Bibis.length+" Bibi(s).")},!1),document.addEventListener("bibi:timeout",function(){console.log("BiB/i: Timeouted.")},!1),document.addEventListener("DOMContentLoaded",a.embed,!1)}}();