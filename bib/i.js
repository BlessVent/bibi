/*!
 *
 *  # Pipi: BiB/i Putter
 *
 *  - "Putting EPUBs in a Web Page with BiB/i."
 *  - (c) Satoru MATSUSHIMA - http://bibi.epub.link/
 *  - Licensed under the MIT license. - http://www.opensource.org/licenses/mit-license.php
 *
 *  - Thu May 28 12:13:00 2015 +0900
 */
!function(){if(!window["bibi:pipi"]){var a=window["bibi:pipi"]={Version:"0.999.0",Build:20150528,Status:"",Bibis:[],Anchors:[],Holders:[],Frames:[],Loaded:0};a.BibiPath=document.querySelector('script[src$="bib/i.js"]').src.replace(/\.js$/,""),a.embed=function(){a.Status="Started";for(var b=document.body.querySelectorAll("a[data-bibi]"),c=b.length,d=0;c>d;d++)if(b[d].getAttribute("href")&&!b[d].Bibi){var e={Index:d,Number:d+1},f=e.Anchor=b[d];/ bibi-anchor /.test(" "+f.className+" ")||(f.className="bibi-anchor"+(f.className?" "+f.className:""));var g=Href=f.getAttribute("href"),h=f.getAttribute("data-bibi-class"),i=f.getAttribute("data-bibi-id"),j=f.getAttribute("data-bibi-style"),k=f.getAttribute("data-bibi-poster"),l=f.getAttribute("data-bibi-autostart");a.Anchors.push(f);var m=e.Holder=a.create("span",{className:"bibi-holder",title:(f.innerText?f.innerText+" ":"")+"(powered by BiB/i)"});if(h&&(m.className+=" "+h),i&&(m.id=i),j&&m.setAttribute("style",j),l&&!/^(false|no)$/.test(l))g+=(/#/.test(g)?",":"#")+"pipi(autostart:true)";else if(k){var n=a.create("link",{href:k});k=n.href,delete n,g+=(/#/.test(g)?",":"#")+"pipi(poster:"+encodeURIComponent(k).replace("(","_BibiKakkoOpen_").replace(")","_BibiKakkoClose_")+")"}a.Holders.push(m);var o=e.Frame=m.appendChild(a.create("iframe",{className:"bibi-frame",frameborder:"0",scrolling:"auto",allowfullscreen:"true",webkitallowfullscreen:"true",mozallowfullscreen:"true",src:g}));a.Frames.push(o);{e.SwitchNewWindow=m.appendChild(a.create("a",{className:"bibi-icon bibi-switch-newwindow",title:"Open in New Window",target:"_blank",href:Href}))}if(a.FullscreenEnabled){m.className+=" bibi-fullscreen-enabled";{e.SwitchFullscreen=m.appendChild(a.create("span",{className:"bibi-icon bibi-switch-fullscreen",title:"Enter Fullscreen",Holder:m,onclick:function(){a.getFullscreenElement(document)?(a.exitFullscreen(document),this.title="Enter Fullscreen"):(a.requestFullscreen(this.Holder),this.title="Exit Fullscreen")}}))}}else m.className+=" bibi-fullscreen-not-enabled";a.Bibis.push(e),o.Bibi=m.Bibi=f.Bibi=e}for(var d=0,c=a.Bibis.length;c>d;d++){var e=a.Bibis[d];e.Embedded||(e.Frame.addEventListener("load",function(){a.Loaded++,this.Bibi.Anchor.dispatchEvent(new CustomEvent("bibi:Loaded",{detail:this.Bibi})),"Timeouted"!=a.Status&&a.Loaded==a.Bibis.length&&(a.Status="Loaded",document.dispatchEvent(new CustomEvent("bibi:Loaded",{detail:a})))},!1),e.Anchor.addEventListener("bibi:Loaded",function(a){console.log("BiB/i: Loaded. - #"+a.detail.Number+": "+a.detail.Anchor.href)},!1),e.Anchor.style.display="none",e.Anchor.parentNode.insertBefore(e.Holder,e.Anchor),e.Anchor.dispatchEvent(new CustomEvent("bibi:Readied",{detail:e})),e.Anchor.dispatchEvent(new CustomEvent("bibi:holderadded",{detail:{holder:e.Holder},bubbles:!0,cancelable:!0})))}return setTimeout(function(){"Loaded"!=a.Status&&(a.Status="Timeouted",document.dispatchEvent(new CustomEvent("bibi:Timeouted",{detail:a})))},12e3),a.Status="Readied",document.dispatchEvent(new CustomEvent("bibi:Readied",{detail:a})),a.Bibis},a.create=function(a,b){var c=document.createElement(a);for(var d in b)c[d]=b[d];return c},(document.body.requestFullscreen||document.body.requestFullScreen||document.body.webkitRequestFullscreen||document.body.webkitRequestFullScreen||document.body.mozRequestFullscreen||document.body.mozRequestFullScreen||document.body.msRequestFullscreen)&&(a.FullscreenEnabled=!0,a.requestFullscreen=function(a){var b=function(b){return function(c){return c||(c=a),c[b]()}};return a.requestFullscreen?b("requestFullscreen"):a.requestFullScreen?b("requestFullScreen"):a.webkitRequestFullscreen?b("webkitRequestFullscreen"):a.webkitRequestFullScreen?b("webkitRequestFullScreen"):a.mozRequestFullscreen?b("mozRequestFullscreen"):a.mozRequestFullScreen?b("mozRequestFullScreen"):a.msRequestFullscreen?b("msRequestFullscreen"):function(){return!1}}(document.documentElement),a.exitFullscreen=function(a){var b=function(b){return function(c){return c||(c=a),c[b]()}};return a.exitFullscreen?b("exitFullscreen"):a.cencelFullScreen?b("cencelFullScreen"):a.webkitExitFullscreen?b("webkitExitFullscreen"):a.webkitCancelFullScreen?b("webkitCancelFullScreen"):a.mozExitFullscreen?b("mozExitFullscreen"):a.mozRequestFullScreen?b("mozRequestFullScreen"):a.msExitFullscreen?b("msExitFullscreen"):function(){return!1}}(document),a.getFullscreenElement=function(a){var b=function(b){return function(c){return c||(c=a),c[b]}};return"undefined"!=typeof a.fullscreenElement?b("fullscreenElement"):"undefined"!=typeof a.fullScreenElement?b("fullScreenElement"):"undefined"!=typeof a.webkitFullscreenElement?b("webkitFullscreenElement"):"undefined"!=typeof a.webkitFullScreenElement?b("webkitFullScreenElement"):"undefined"!=typeof a.mozFullscreenElement?b("mozFullscreenElement"):"undefined"!=typeof a.mozFullScreenElement?b("mozFullScreenElement"):"undefined"!=typeof a.msFullscreenElement?b("msFullscreenElement"):function(){return null}}(document)),"undefined"==typeof window.CustomEvent&&(window.CustomEvent=function(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c},window.CustomEvent.prototype=window.Event.prototype),document.getElementsByTagName("head")[0].appendChild(a.create("link",{rel:"stylesheet",id:"bibi-css",href:a.BibiPath+".css"})),document.addEventListener("bibi:Readied",function(a){console.log("BiB/i: Readied. - "+a.detail.Bibis.length+" Bibi(s).")},!1),document.addEventListener("bibi:Loaded",function(a){console.log("BiB/i: Loaded. - "+a.detail.Bibis.length+" Bibi(s).")},!1),document.addEventListener("bibi:Timeouted",function(a){console.log("BiB/i: Timeouted. - "+a.detail.Bibis.length+" Bibi(s).")},!1),document.addEventListener("DOMContentLoaded",a.embed,!1)}}();