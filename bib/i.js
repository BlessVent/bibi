/*!
 *
 *  # Pipi: BiB/i Putter
 *
 *  - "Putting EPUBs in a Web Page with BiB/i."
 *  - (c) Satoru MATSUSHIMA - http://bibi.epub.link/
 *  - Licensed under the MIT license. - http://www.opensource.org/licenses/mit-license.php
 *
 *  - Fri May 15 19:13:00 2015 +0900
 */
Pipi={Version:"0.999.0",Build:20150515},function(a){window["bibi:pipi"]||(window["bibi:pipi"]={Status:"",Bibis:[],Anchors:[],Holders:[],Frames:[],Loaded:0},document.addEventListener("bibi:started",function(){console.log("BiB/i: Started.")},!1),document.addEventListener("bibi:ended",function(){console.log("BiB/i: Ended.")},!1),document.addEventListener("bibi:readied",function(a){console.log("BiB/i: Readied. - "+a.detail.Bibis.length+" Bibi(s).")},!1),document.addEventListener("bibi:loaded",function(a){console.log("BiB/i: Loaded. - "+a.detail.Bibis.length+" Bibi(s).")},!1),document.addEventListener("bibi:timeouted",function(a){console.log("BiB/i: Timeouted. - "+a.detail.Bibis.length+" Bibi(s).")},!1),document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",a,!1))}(function(){if(!window["bibi:pipi"].Status){window["bibi:pipi"].Status="started",document.dispatchEvent(new CustomEvent("bibi:started",{detail:window["bibi:pipi"]}));for(var a=document.body.querySelectorAll("a[data-bibi]"),b=a.length,c=0;b>c;c++)a[c].getAttribute("href")&&window["bibi:pipi"].Anchors.push(a[c]);if(window["bibi:pipi"].Anchors.length){var d=function(a,b){var c=document.createElement(a);for(var d in b)c[d]=b[d];return c};if("undefined"==typeof window.CustomEvent&&(window.CustomEvent=function(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c},window.CustomEvent.prototype=window.Event.prototype),document.body.requestFullscreen||document.body.requestFullScreen||document.body.webkitRequestFullscreen||document.body.webkitRequestFullScreen||document.body.mozRequestFullscreen||document.body.mozRequestFullScreen||document.body.msRequestFullscreen){window["bibi:pipi"].FullscreenEnabled=!0;var e=function(a){var b=function(b){return function(c){return c||(c=a),c[b]()}};return a.requestFullscreen?b("requestFullscreen"):a.requestFullScreen?b("requestFullScreen"):a.webkitRequestFullscreen?b("webkitRequestFullscreen"):a.webkitRequestFullScreen?b("webkitRequestFullScreen"):a.mozRequestFullscreen?b("mozRequestFullscreen"):a.mozRequestFullScreen?b("mozRequestFullScreen"):a.msRequestFullscreen?b("msRequestFullscreen"):function(){return!1}}(document.documentElement),f=function(a){var b=function(b){return function(c){return c||(c=a),c[b]()}};return a.exitFullscreen?b("exitFullscreen"):a.cencelFullScreen?b("cencelFullScreen"):a.webkitExitFullscreen?b("webkitExitFullscreen"):a.webkitCancelFullScreen?b("webkitCancelFullScreen"):a.mozExitFullscreen?b("mozExitFullscreen"):a.mozRequestFullScreen?b("mozRequestFullScreen"):a.msExitFullscreen?b("msExitFullscreen"):function(){return!1}}(document),g=function(a){var b=function(b){return function(c){return c||(c=a),c[b]}};return"undefined"!=typeof a.fullscreenElement?b("fullscreenElement"):"undefined"!=typeof a.fullScreenElement?b("fullScreenElement"):"undefined"!=typeof a.webkitFullscreenElement?b("webkitFullscreenElement"):"undefined"!=typeof a.webkitFullScreenElement?b("webkitFullScreenElement"):"undefined"!=typeof a.mozFullscreenElement?b("mozFullscreenElement"):"undefined"!=typeof a.mozFullScreenElement?b("mozFullScreenElement"):"undefined"!=typeof a.msFullscreenElement?b("msFullscreenElement"):function(){return null}}(document)}window["bibi:pipi"].BibiPath=document.querySelector('script[src$="bib/i.js"]').src.replace(/\.js$/,""),document.getElementsByTagName("head")[0].appendChild(d("link",{rel:"stylesheet",id:"bibi-css",href:window["bibi:pipi"].BibiPath+".css"}));for(var b=window["bibi:pipi"].Anchors.length,c=0;b>c;c++){var h={Index:c,Number:c+1},i=h.Anchor=window["bibi:pipi"].Anchors[c];/ bibi-anchor /.test(" "+i.className+" ")||(i.className="bibi-anchor"+(i.className?" "+i.className:""));var j=h.Holder=d("span",{className:"bibi-holder",title:(i.innerText?i.innerText+" ":"")+"(powered by BiB/i)"}),k=i.getAttribute("href"),l=k,m=i.getAttribute("data-bibi-class"),n=i.getAttribute("data-bibi-id"),o=i.getAttribute("data-bibi-style"),p=i.getAttribute("data-bibi-poster"),q=i.getAttribute("data-bibi-autostart");if(m&&(j.className+=" "+m),n&&(j.id=n),o&&j.setAttribute("style",o),q&&!/^(false|no)$/.test(q))l+=(/#/.test(l)?",":"#")+"pipi(autostart:true)";else if(p){var r=d("link",{href:p});p=r.href,delete r,l+=(/#/.test(l)?",":"#")+"pipi(poster:"+encodeURIComponent(p).replace("(","_BibiKakkoOpen_").replace(")","_BibiKakkoClose_")+")"}window["bibi:pipi"].Holders.push(j);var s=h.Frame=j.appendChild(d("iframe",{className:"bibi-frame",frameborder:"0",scrolling:"auto",allowfullscreen:"true",webkitallowfullscreen:"true",mozallowfullscreen:"true",src:l}));window["bibi:pipi"].Frames.push(s);{h.SwitchNewWindow=j.appendChild(d("a",{className:"bibi-icon bibi-switch-newwindow",title:"Open in New Window",target:"_blank",href:k}))}if(window["bibi:pipi"].FullscreenEnabled){j.className+=" bibi-fullscreen-enabled";{h.SwitchFullscreen=j.appendChild(d("span",{className:"bibi-icon bibi-switch-fullscreen",title:"Enter Fullscreen",Holder:j,onclick:function(){g(document)?(f(document),this.title="Enter Fullscreen"):(e(this.Holder),this.title="Exit Fullscreen")}}))}}else j.className+=" bibi-fullscreen-not-enabled";window["bibi:pipi"].Bibis.push(h),s.Bibi=j.Bibi=i.Bibi=h,s.addEventListener("load",function(){window["bibi:pipi"].Loaded++,this.Bibi.Anchor.dispatchEvent(new CustomEvent("bibi:loaded",{detail:this.Bibi})),"timeouted"!=window["bibi:pipi"].Status&&window["bibi:pipi"].Loaded==window["bibi:pipi"].Anchors.length&&(window["bibi:pipi"].Status="loaded",document.dispatchEvent(new CustomEvent("bibi:loaded",{detail:window["bibi:pipi"]})))},!1),i.addEventListener("bibi:loaded",function(a){console.log("BiB/i: Loaded. - "+a.detail.Index+": "+a.detail.Anchor.href)},!1),i.style.display="none",i.parentNode.insertBefore(j,i),i.dispatchEvent(new CustomEvent("bibi:readied",{detail:h})),i.dispatchEvent(new CustomEvent("bibi:holderadded",{detail:{holder:j},bubbles:!0,cancelable:!0}))}setTimeout(function(){"loaded"!=window["bibi:pipi"].Status&&(window["bibi:pipi"].Status="timeouted",document.dispatchEvent(new CustomEvent("bibi:timeouted",{detail:window["bibi:pipi"]})))},12e3),window["bibi:pipi"].Status="readied",document.dispatchEvent(new CustomEvent("bibi:readied",{detail:window["bibi:pipi"]}))}else window["bibi:pipi"].Status="ended",document.dispatchEvent(new CustomEvent("bibi:ended",{detail:window["bibi:pipi"]}))}});