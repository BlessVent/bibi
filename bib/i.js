/*!
 *
 *  # Pipi: BiB/i Putter
 *
 *  - "Putting EPUBs in a Web Page with BiB/i."
 *  - (c) Satoru MATSUSHIMA - http://bibi.epub.link/
 *  - Licensed under the MIT license. - http://www.opensource.org/licenses/mit-license.php
 */
!function(){if(!window["bibi:pipi"]){var e=window["bibi:pipi"]={version:"0.999.0",build:20150929.1551,Status:"",Bibis:[],Anchors:[],Holders:[],Frames:[],Loaded:0};e.BibiPath=document.querySelector('script[src$="bib/i.js"]').src.replace(/\.js$/,""),e.embed=function(){e.Status="Started";for(var t=document.body.querySelectorAll("a[data-bibi]"),n=t.length,i=0;n>i;i++)if(t[i].getAttribute("href")&&!t[i].Bibi){var l={Index:i,Number:i+1},r=l.Anchor=t[i];/ bibi-anchor /.test(" "+r.className+" ")||(r.className="bibi-anchor"+(r.className?" "+r.className:""));var o=Href=r.getAttribute("href"),s=r.getAttribute("data-bibi-class"),u=r.getAttribute("data-bibi-id"),c=r.getAttribute("data-bibi-style"),d=r.getAttribute("data-bibi-poster"),a=r.getAttribute("data-bibi-autostart"),b=r.getAttribute("data-bibi-reader-view-mode"),m=r.getAttribute("data-bibi-to"),h=r.getAttribute("data-bibi-nav"),f=r.getAttribute("data-bibi-view"),w=r.getAttribute("data-bibi-arrows");r.addEventListener("bibi:load",function(e){console.log("BiB/i: Loaded. - #"+e.detail.Number+": "+e.detail.Anchor.href)},!1),r.addEventListener("bibi:openInNewWindow",function(e){console.log("BiB/i: Opened in New Window. - #"+e.detail.Number+": "+e.detail.Anchor.href)},!1),r.addEventListener("bibi:requestFullscreen",function(e){console.log("BiB/i: Entered Fullscreen. - #"+e.detail.Number+": "+e.detail.Anchor.href)},!1),r.addEventListener("bibi:exitFullscreen",function(e){console.log("BiB/i: Exited Fullscreen. - #"+e.detail.Number+": "+e.detail.Anchor.href)},!1),e.Anchors.push(r);var p=l.Holder=e.create("span",{className:"bibi-holder",title:(r.innerText?r.innerText+" ":"")+"(powered by BiB/i)"});s&&(p.className+=" "+s),u&&(p.id=u),c&&p.setAttribute("style",c);var E=[];if(location.origin!=r.origin&&E.push("parent-origin:"+e.encode(location.origin)),d){var F=e.create("link",{href:d});d=F.href,delete F,E.push("poster:"+e.encode(d))}a&&/^(undefined|autostart|yes|true)?$/.test(a)&&E.push("autostart"),b&&/^(horizontal|vertical|paged)?$/.test(b)&&E.push("reader-view-mode:"+b),m&&/^[1-9][\d\-\.]*$/.test(m)&&E.push("to:"+m),h&&/^[1-9]\d*$/.test(h)&&E.push("nav:"+h),f&&/^fixed$/.test(f)&&E.push("view:"+f),w&&/^hidden$/.test(w)&&E.push("arrows:"+w),E.length&&(o+=(/#/.test(o)?",":"#")+"pipi("+E.join(",")+")"),e.Holders.push(p);var v=l.Frame=p.appendChild(e.create("iframe",{className:"bibi-frame",frameborder:"0",scrolling:"auto",allowfullscreen:"true",webkitallowfullscreen:"true",mozallowfullscreen:"true",src:o}));v.addEventListener("load",function(){e.Loaded++,this.Bibi.Anchor.dispatchEvent(new CustomEvent("bibi:load",{detail:this.Bibi})),"Timeouted"!=e.Status&&e.Loaded==e.Bibis.length&&(e.Status="Loaded",document.dispatchEvent(new CustomEvent("bibi:load",{detail:e})))},!1),e.Frames.push(v);var g=l.SwitchNewWindow=e.create("a",{className:"bibi-icon bibi-switch-newwindow",title:"Open in New Window",target:"_blank",href:Href,openInNewWindow:function(){window.open(this.href,this.target),r.dispatchEvent(new CustomEvent("bibi:openInNewWindow",{detail:this.Bibi}))}});g.addEventListener("click",function(e){return e.preventDefault(),e.stopPropagation(),this.openInNewWindow(),!1}),g.style.display="none",r.addEventListener("bibi:load",function(){this.Bibi.SwitchNewWindow.style.display=""}),p.appendChild(g);var S=l.SwitchFullscreen=e.create("span",{className:"bibi-icon bibi-switch-fullscreen",title:"Enter Fullscreen",Holder:p,toggleFullscreen:function(){e.getFullscreenElement(document)?(this.Holder.style.cssText=this.Holder.DefaultStyle,e.exitFullscreen(document),this.title="Enter Fullscreen",r.dispatchEvent(new CustomEvent("bibi:exitFullscreen",{detail:this.Bibi}))):(this.Holder.DefaultStyle=this.Holder.style.cssText+"",this.Holder.style.cssText="margin: 0; border: none 0; padding: 0; width: 100%; height: 100%; max-width: none; max-height: none; min-width: none; min-height: none;",e.requestFullscreen(this.Holder),this.title="Exit Fullscreen",r.dispatchEvent(new CustomEvent("bibi:requestFullscreen",{detail:this.Bibi})))}});S.addEventListener("click",function(e){return e.preventDefault(),e.stopPropagation(),this.toggleFullscreen(),!1}),S.style.display="none",p.appendChild(S),e.FullscreenEnabled?(p.className+=" bibi-fullscreen-enabled",r.addEventListener("bibi:load",function(){this.Bibi.SwitchFullscreen.style.display=""})):p.className+=" bibi-fullscreen-not-enabled",e.Bibis.push(l),v.Bibi=p.Bibi=r.Bibi=g.Bibi=S.Bibi=l}for(var i=0,n=e.Bibis.length;n>i;i++)if(!e.Bibis[i].Embedded){var l=e.Bibis[i];l.move=function(e){"number"==typeof Target&&this.Frame.contentWindow.postMessage('{"bibi:command:move":"'+e+'"}',this.Anchor.origin)},l.focus=function(e){("string"==typeof e||"number"==typeof e)&&this.Frame.contentWindow.postMessage('{"bibi:command:focus":"'+e+'"}',this.Anchor.origin)},l.changeView=function(e){"string"==typeof Target&&this.Frame.contentWindow.postMessage('{"bibi:command:changeView":"'+e+'"}',this.Anchor.origin)},l.togglePanel=function(){this.Frame.contentWindow.postMessage('{"bibi:command:togglePanel":""}',this.Anchor.origin)},l.openInNewWindow=function(){this.SwitchNewWindow.click()},l.toggleFullscreen=function(){this.SwitchFullscreen.click()},l.Anchor.style.display="none",l.Anchor.parentNode.insertBefore(l.Holder,l.Anchor),l.Anchor.dispatchEvent(new CustomEvent("bibi:ready",{detail:l})),l.Anchor.dispatchEvent(new CustomEvent("bibi:holderadded",{detail:{holder:l.Holder},bubbles:!0,cancelable:!0}))}return setTimeout(function(){"Loaded"!=e.Status&&(e.Status="Timeouted",document.dispatchEvent(new CustomEvent("bibi:timeout",{detail:e})))},12e3),e.Status="Readied",document.dispatchEvent(new CustomEvent("bibi:ready",{detail:e})),e.Bibis},e.encode=function(e){return encodeURIComponent(e).replace("(","_BibiKakkoOpen_").replace(")","_BibiKakkoClose_")},e.create=function(e,t){var n=document.createElement(e);for(var i in t)n[i]=t[i];return n},(document.fullscreenEnabled||document.fullScreenEnabled||document.webkitFullscreenEnabled||document.webkitFullScreenEnabled||document.mozFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.msFullScreenEnabled)&&(e.FullscreenEnabled=!0,e.requestFullscreen=function(e){var t=function(t){return function(n){return n||(n=e),n[t]()}};return e.requestFullscreen?t("requestFullscreen"):e.requestFullScreen?t("requestFullScreen"):e.webkitRequestFullscreen?t("webkitRequestFullscreen"):e.webkitRequestFullScreen?t("webkitRequestFullScreen"):e.mozRequestFullscreen?t("mozRequestFullscreen"):e.mozRequestFullScreen?t("mozRequestFullScreen"):e.msRequestFullscreen?t("msRequestFullscreen"):e.msRequestFullScreen?t("msRequestFullScreen"):function(){return!1}}(document.documentElement),e.exitFullscreen=function(e){var t=function(t){return function(n){return n||(n=e),n[t]()}};return e.exitFullscreen?t("exitFullscreen"):e.cencelFullScreen?t("cencelFullScreen"):e.webkitExitFullscreen?t("webkitExitFullscreen"):e.webkitCancelFullScreen?t("webkitCancelFullScreen"):e.mozExitFullscreen?t("mozExitFullscreen"):e.mozCancelFullScreen?t("mozCancelFullScreen"):e.msExitFullscreen?t("msExitFullscreen"):e.msCancelFullScreen?t("msCancelFullScreen"):function(){return!1}}(document),e.getFullscreenElement=function(e){var t=function(t){return function(n){return n||(n=e),n[t]}};return"undefined"!=typeof e.fullscreenElement?t("fullscreenElement"):"undefined"!=typeof e.fullScreenElement?t("fullScreenElement"):"undefined"!=typeof e.webkitFullscreenElement?t("webkitFullscreenElement"):"undefined"!=typeof e.webkitFullScreenElement?t("webkitFullScreenElement"):"undefined"!=typeof e.mozFullscreenElement?t("mozFullscreenElement"):"undefined"!=typeof e.mozFullScreenElement?t("mozFullScreenElement"):"undefined"!=typeof e.msFullscreenElement?t("msFullscreenElement"):"undefined"!=typeof e.msFullScreenElement?t("msFullScreenElement"):function(){return null}}(document)),(!window.CustomEvent||"function"!=typeof window.CustomEvent&&-1===window.CustomEvent.toString().indexOf("CustomEventConstructor"))&&(window.CustomEvent=function(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n},window.CustomEvent.prototype=window.Event.prototype),document.getElementsByTagName("head")[0].appendChild(e.create("link",{rel:"stylesheet",id:"bibi-css",href:e.BibiPath+".css"})),document.addEventListener("bibi:ready",function(e){console.log("BiB/i: Readied. - "+e.detail.Bibis.length+" Bibi(s).")},!1),document.addEventListener("bibi:load",function(e){console.log("BiB/i: Loaded. - "+e.detail.Bibis.length+" Bibi(s).")},!1),document.addEventListener("bibi:timeout",function(e){console.log("BiB/i: Timeouted.")},!1),document.addEventListener("DOMContentLoaded",e.embed,!1)}}();