



指定マニュアル 2016/02/03 版
====================================================================================================




かんたんですが、プリセットについて解説します。今後マニュアルにまとめる計画ですので、読みづらさはしばしご容赦ください。




プリセットとは / つかいかた
----------------------------------------------------------------------------------------------------

プリセットファイルとは、リーダとしてのデフォルト挙動やレイアウトの初期設定を外部化したテキストファイルです。
これを編集することでビビをカスタマイズすることができます。書式は、というか実態は JavaScript のオブジェクトです。

プリセットファイルは bib/preset/ フォルダに入れてつかいます。
このフォルダ内に入れておけば、アクセス時に URL のハッシュにつける bibi(preset:ファイル名.js) で使い分けることができます。

EPUB をドラッグアンドドロップしてもらうときも予め設定を読ませておけますし、
サーバに置いた EPUB やフォルダを読むときも、プリセットをペアにした URL を発行できます。

* http://anatano.website/bib/i/#bibi(preset:PRESET.js)
* http://anatano.website/bib/i/?book=EPUB.epub#bibi(preset:PRESET.js)
* http://anatano.website/bib/i/?book=EPUB#bibi(preset:PRESET.js)

指定がないときは、bib/preset/ フォルダ内にある default.js が使用されます。
まずは default.js を編集して使うのがよいかもしれません。

以下、具体的な指定について説明しますが、
多くは、対象とする EPUB によって一長一短があります。
だからこそプリセットとして編集可能にしてあるというわけです。

読者自身が読みながらボタンで変更できる項目もありますが、
ご自身で作成した EPUB を読者に見せたい場合や、
ご自身で見た目をカスタマイズした BiB/i を読者に使ってもらいたい場合など、
EPUB に合わせたスタイルやあなたらしいスタイルを予めプリセットで指定しておくと、
きっとステキだと思います。



### この文書内で使用される用語の定義

アイテムとは、表示されるファイルひとつひとつのことです。

「見開き」とは、アイテムをつつむブロックです。
リフロー指定のアイテムはそれ１つだけで「見開き」を構成します。
固定レイアウトで左右ペアが作られている場合は、その２つが１つの「見開き」に入ります。

「長さ」は、見開きの進行方向サイズのことです。
横並びなら左右幅、縦並びなら上下高にあたります。
同様に「広さ」は、横並びなら上下高、縦並びなら左右幅です。
そして、それらの数値が小さい状態を「短い」「狭い」ということにします。




"name": "なまえ" …… プリセットの任意名称
----------------------------------------------------------------------------------------------------

いまのところどこにも使用されていませんが、
いつかコントロールパネルからプリセットを切り替える機能をつけるかもしれず、
その暁には設定パネル内でラベルとして使用される予定であります。




"description": "説明" …… プリセットの内容説明
----------------------------------------------------------------------------------------------------

これも、切り替え機能で使うかもしれません。




"bookshelf" …… bookshelf ディレクトリまでのパス
----------------------------------------------------------------------------------------------------

bib/i/index.html からみた bookshelf ディレクトリのパスを記述します。
同じウェブサーバ内の bookshelf ディレクトリまでの相対パス・ルート相対パスのほか、
クロスオリジンリクエストが許可されたサーバの bookshelf ディレクトリを http(s):// から書くこともできます。




"reader-view-mode" …… 表示モードの初期値（ページめくり・横スクロール・縦スクロール）
----------------------------------------------------------------------------------------------------

"paged" を指定するとページめくりモード、
"horizontal" なら横スクロールモード、
"vertical" なら縦スクロールモードで表示を開始します。
読者は随時変更できるので、あくまで最初にどのモードで表示するか、ということです。




"reader-view-mode-fixed" …… 表示モードの変更を禁止するかどうか
----------------------------------------------------------------------------------------------------

true にすると、ユーザが表示モードを変更できなくなり、変更ボタンも表示されなくなります。
初期値は false で、そのままにしておくことをオススメしますが、
コンテンツの性質によって禁止したほうがユーザ体験を向上させられるときに使います。




"ui-font-family" …… 目次やその他の基本 UI のフォント指定
----------------------------------------------------------------------------------------------------

CSS の font-family そのままで指定できます。
たとえば、台湾では句読点をボックス中央に配置したフォントが一般的なのでそういうフォントを使いたい、
といった事情があるとき、デフォルトフォントを指定できます。




"book-background" …… 見開きの下の背景
----------------------------------------------------------------------------------------------------

CSS の background そのままでどうぞ。つまり背景画像なども使えます。




"spread-gap" …… 見開きと見開きの間隔（旧 "spread-separation"）
----------------------------------------------------------------------------------------------------

見開き同士の間隔です。単位は px。

その計算を「美しく」行うため、プリセットで奇数値が指定されていても、1足して強制的に偶数にしています。
（小数点以下を含む指定は偶数奇数の判断の前に四捨五入してしまいます）

最初と最後の見開きとウィンドウ端の距離は、この半分の値になります。
ただし、もしウィンドウよりも幅が狭い場合、ウィンドウの真ん中に来るようにウィンドウ端との距離が調節されます。




"spread-margin-start" / "spread-margin-before" …… 見開きとウィンドウの間隔
----------------------------------------------------------------------------------------------------

見開きとウィンドウの、見開き配置方向と垂直方向にあたる側の間隔です。単位は px。

"spread-margin-start" は、
左から右への横スクロールモードならば左、右から左ならば右です。
ページめくり・横スクロールモードのときは上。

"spread-margin-end" は "spread-margin-start" の反対側です。




"spread-border-radius" …… 見開きのカドを丸めるならその半径
----------------------------------------------------------------------------------------------------

CSS 3 でできるようになったことのうち、
多くのウェブ制作者がもっともわかりやすく小躍りしたという言い伝えがある、カド丸指定です。
CSS の border-radius そのままなので、お好みでどうぞ。




"spread-box-shadow" …… 見開きに影を付けるなら CSS を
----------------------------------------------------------------------------------------------------

カド丸に並びウェブ制作者を小躍りさせたと語り伝えられる、ドロップシャドウ。
CSS の box-shadow そのままです。

影を付けるとすこしスクロールがもたつくかもしれませんので、
ないほうがいいかもしれませんね。不要なら "none" もしくは "" としてください。




"item-padding-left" / "****-right" / "****-top" / "****-bottom" …… 各アイテム内の余白
----------------------------------------------------------------------------------------------------

見開きの内側、EPUB 内の各 HTML が描画される領域までの余白です。
数値の単位はすべて px（ピクセル）。

グチですが……ホントは全部 0 でいいはずじゃないかと思うんです。
ただ、iBooks はじめ、制御不能な余白をつけるリーディングシステムが幅を利かせています。
あれはほんとうにキライですが、そう言っても仕方ありません。
そうしたリーディングシステムに合わせて余白を持たせていない EPUB がかなり多いため、この項目はそのためにあります。
EPUB 内の HTML に適用された背景色・背景画像もこの余白に反映されるように処理しています。

アイテムが固定レイアウトのときは無視され、BiB/i による余白調整は行われません。




"item-column-rule" …… 段組されたときの境界線表示
----------------------------------------------------------------------------------------------------

CSS の column-rule そのままです。不要なら "" 空値にしておきます。

ちなみにビビではなく CSS の領分の話ですが、この線の太さは、column-gap に影響しません。




"page-breaking" …… 改ページ指定を有効にするかどうか【対応不完全】
----------------------------------------------------------------------------------------------------

true にすると、CSS の page-break-before と page-break-after によって改ページを行います。
初期値は false です。

……うまく動いていません。false のままにしておくことをオススメします。



"google-analytics-tracking-id" …… Google Analytics トラッキング ID
----------------------------------------------------------------------------------------------------

Analytics エクステンションが有効なとき（初期状態で有効です）、
トラッキング ID（書式：UA-XXXXXXXX-X）を入力すると、
再生ボタンのクリック／タップや、最後まで読んだかどうかなどがイベントとして Google Analytics に記録されます。



"epub-additional-stylesheet" / "epub-additional-script" …… EPUB 内のコンテンツに任意の CSS / JavaScript を追加
----------------------------------------------------------------------------------------------------

EPUB 内のコンテンツを編集することなく、すべてのアイテムに CSS / JavaScript を追加できます。
ご自分のスタイルで読みたい・検証や校正のためのスクリプトを追加して表示確認したい、などの要望に応える機能です。

値には、パスをそのまま指定します。



